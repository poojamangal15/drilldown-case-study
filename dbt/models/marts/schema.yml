version: 2

models:
  - name: sales_rep_perf
    description: "Win/loss and win rate by sales rep (uses canonical stages)."
    columns:
      - name: sales_rep_id
        tests: [not_null]
      - name: win_rate
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
              inclusive: true

  - name: lead_source_financial_impact
    description: "A simulation model that calculates the potential revenue uplift from reallocating marketing efforts from 'Cold Call' to 'Referral' programs."
    columns:
      - name: recommendation
        description: "The business recommendation derived from the simulation."

      - name: cold_call_company_count
        description: "The number of companies acquired via the 'Cold Call' lead source."

      - name: actual_cold_call_revenue
        description: "The actual total revenue generated from companies acquired via 'Cold Call'."

      - name: simulated_revenue_from_referrals
        description: "The simulated total revenue if the same number of companies had been acquired through the 'Referral' channel."

      - name: potential_revenue_uplift
        description: "The calculated difference between the simulated and actual revenue, representing the potential financial gain."
        tests:
          - dbt_utils.accepted_range:
              min_value: 0

  - name: customer_cohort_analysis
    description: "Tracks monthly revenue and active customers for cohorts grouped by their acquisition month. This is used to analyze customer retention and long-term value."
    columns:
      - name: cohort_month
        description: "The month in which a group of customers was first acquired."
        tests:
          - not_null

      - name: invoice_year
        description: "The year of the invoice period."

      - name: invoice_month_number
        description: "The number of the month of the invoice period (1-12)."

      - name: months_after_acquisition
        description: "The number of months that have passed since the cohort was acquired (e.g., month 0 is the acquisition month)."
        tests:
          - not_null

      - name: active_customers
        description: "The number of unique customers from the cohort who made a purchase in this specific invoice month."
        tests:
          - not_null

      - name: total_monthly_revenue
        description: "The total revenue generated by this cohort in this specific invoice month."
        tests:
          - not_null
